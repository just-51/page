<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ¬ è§†é¢‘æ’­æ”¾</title>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    min-height: 100vh;
    padding: 80px 20px 20px;
  }
  .content-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-width: 90vw;
  }
  h1 {
    font-size: 16px;
    margin-bottom: 20px;
    text-align: center;
    opacity: 0.7;
  }
  .video-container {
    position: relative;
    width: 100%;
  }
  video {
    width: 100%;
    height: auto;
    border-radius: 12px;
    background: #000;
  }
  .loading-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.4);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: white;
    font-size: 14px;
    pointer-events: none;
  }
  .spinner {
    border: 4px solid rgba(255,255,255,0.2);
    border-left-color: #00ff88;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin-bottom: 10px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .video-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 20px;
    gap: 10px;
  }
  .video-button {
    padding: 10px 16px;
    font-size: 15px;
    border: none;
    border-radius: 8px;
    background-color: #333;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .video-button:hover { background-color: #555; }
  .video-button.active { background-color: #00c300; }
</style>
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js"></script>
</head>
<body>

<div class="content-wrapper">
  <h1>ðŸŽ¬ è¯·å‹¿ç›¸ä¿¡è§†é¢‘ä¸­çš„å¹¿å‘Š</h1>

  <div class="video-container">
    <video id="video" playsinline webkit-playsinline preload="auto" controls></video>
    <div class="loading-overlay" id="loadingOverlay">
      <div class="spinner"></div>
      æ­£åœ¨åŠ è½½è§†é¢‘...
    </div>
  </div>
</div>

<div class="video-list" id="videoList">
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNS5maGJiZmYuY29tLzIwMjUwNjI5L2hBN2l0blVkL2luZGV4Lm0zdTg=">è§†é¢‘1</button>
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNC5maGJiZmYuY29tLzIwMjQxMTE5L2dvbGp6a2lNL2luZGV4Lm0zdTg=">è§†é¢‘2</button>
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNS5maGJiZmYuY29tLzIwMjUwNDE4L3pPUG9KeTlPL2luZGV4Lm0zdTg=">è§†é¢‘3</button>
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNS5maGJiZmYuY29tLzIwMjUwNjI3LzRnUXdUa0ptL2luZGV4Lm0zdTg=">è§†é¢‘4</button>
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNS5maGJiZmYuY29tLzIwMjUwOTA3L2drOHVWRGNaaS9pbmRleC5tM3U4=">è§†é¢‘5</button>
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNS5maGJiZmYuY29tLzIwMjUwNzA4L1lIcHdyb1hIL2luZGV4Lm0zdTg=">è§†é¢‘6</button>
</div>

<script>
const video = document.getElementById('video');
const buttons = document.querySelectorAll('.video-button');
const loadingOverlay = document.getElementById('loadingOverlay');
let hls = null;

function isIOS(){ return /iP(hone|od|ad)/.test(navigator.userAgent); }
function saveProgress(url,time){ localStorage.setItem("progress_"+url,time.toFixed(1)); }
function loadProgress(url){ const t=parseFloat(localStorage.getItem("progress_"+url)); return isNaN(t)?0:t; }
function setActiveButton(enc){ buttons.forEach(btn=>btn.classList.toggle('active',btn.dataset.enc.trim()===enc)); }
function showLoading(){ loadingOverlay.style.display='flex'; }
function hideLoading(){ loadingOverlay.style.display='none'; }
function decodeBase64(str){ try{ return atob(str); }catch(e){ alert("è§†é¢‘åœ°å€è§£ç å¤±è´¥"); return ""; } }

function loadVideo(url,resumeTime,isM3U8){
  showLoading();
  video.pause();
  video.removeAttribute('src');
  video.load();
  if(hls){ hls.destroy(); hls=null; }

  video.poster="loading.jpg";

  if(isM3U8 && !isIOS() && typeof Hls!=='undefined'){
    hls = new Hls({ maxBufferLength:30, maxMaxBufferLength:60 });
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, ()=>{
      video.currentTime = resumeTime;
      video.play().catch(()=>{});
      hideLoading();
    });
  } else {
    video.src=url;
    video.addEventListener('loadedmetadata', function onLoaded(){
      video.removeEventListener('loadedmetadata', onLoaded);
      video.currentTime = resumeTime;
      video.play().catch(()=>{});
      hideLoading();
    });
  }

  video.controls=true;
  video.removeEventListener('timeupdate',video._saveHandler);
  video._saveHandler=()=>saveProgress(url,video.currentTime);
  video.addEventListener('timeupdate',video._saveHandler);
}

function loadVideoFromEncoded(encStr){
  const url=decodeBase64(encStr.trim());
  if(!url) return;
  const isM3U8=url.includes(".m3u8");
  const resumeTime=loadProgress(url);
  setActiveButton(encStr);
  loadVideo(url,resumeTime,isM3U8);
}

// åˆå§‹åŒ–ç¬¬ä¸€ä¸ªè§†é¢‘
loadVideoFromEncoded(buttons[0].dataset.enc.trim());

// æŒ‰é’®åˆ‡æ¢
buttons.forEach(btn=>{
  btn.addEventListener('click',()=> loadVideoFromEncoded(btn.dataset.enc.trim()));
});

video.addEventListener('playing',hideLoading);
video.addEventListener('canplay',hideLoading);
</script>

</body>
</html>
