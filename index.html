<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🎬 hello</title>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    min-height: 100vh;
    padding: 80px 20px 20px;
  }
  .content-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-width: 90vw;
  }
  h1 {
    font-size: 16px;
    margin-bottom: 20px;
    text-align: center;
    opacity: 0.7;
  }
  .video-container {
    position: relative;
    width: 100%;
  }
  video {
    width: 100%;
    height: auto;
    border-radius: 12px;
    background: #000;
  }
  .loading-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    pointer-events: none;
    border-radius: 12px;
  }
  .loader {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.2);
    border-top-color: #00ff88;
    border-radius: 50%;
    animation: spin 1s linear infinite, pulse 1.5s ease-in-out infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(0,255,136,0.6); }
    50% { box-shadow: 0 0 15px 5px rgba(0,255,136,0.3); }
  }
  .loading-text {
    margin-top: 10px;
    font-size: 14px;
    color: #00ff88;
    letter-spacing: 1px;
    display: flex;
    align-items: center;
  }
  .dots span {
    opacity: 0;
    color: #00ff88;
    text-shadow: 0 0 5px #00ff88, 0 0 10px #00ff88;
    animation: blink 1.5s infinite;
  }
  .dots span:nth-child(1) { animation-delay: 0s; }
  .dots span:nth-child(2) { animation-delay: 0.3s; }
  .dots span:nth-child(3) { animation-delay: 0.6s; }
  @keyframes blink {
    0%, 20% { opacity: 0; }
    30%, 80% { opacity: 1; }
    100% { opacity: 0; }
  }
  .video-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 20px;
    gap: 10px;
  }
  .video-button {
    padding: 10px 16px;
    font-size: 15px;
    border: none;
    border-radius: 8px;
    background-color: #333;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .video-button:hover { background-color: #555; }
  .video-button.active { background-color: #00c300; }
</style>
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js"></script>
</head>
<body>
<div class="content-wrapper">
  <h1>🎬 请勿相信视频中的广告</h1>
  <div class="video-container">
    <video id="video" playsinline webkit-playsinline preload="auto" controls></video>
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loader"></div>
      <div class="loading-text">
        正在加载视频<span class="dots"><span>.</span><span>.</span><span>.</span></span>
      </div>
    </div>
  </div>
</div>

<div class="video-list" id="videoList">
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNS5maGJiZmYuY29tLzIwMjUwNjI5L2hBN2l0blVkL2luZGV4Lm0zdTg=">视频1</button>
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNC5maGJiZmYuY29tLzIwMjQxMTE5L2dvbGp6a2lNL2luZGV4Lm0zdTg=">视频2</button>
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNS5maGJiZmYuY29tLzIwMjUwNDE4L3pPUG9KeTlPL2luZGV4Lm0zdTg=">视频3</button>
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNS5maGJiZmYuY29tLzIwMjUwNjI3LzRnUXdUa0ptL2luZGV4Lm0zdTg=">视频4</button>
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNS5maGJiZmYuY29tLzIwMjUwOTA3L2drOHVWRGNaL2luZGV4Lm0zdTg=">视频5</button>
  <button class="video-button" data-enc="aHR0cHM6Ly92MjAyNS5maGJiZmYuY29tLzIwMjUwNzA4L1lIcHdyb1hIL2luZGV4Lm0zdTg=">视频6</button>
</div>

<script>
const video = document.getElementById('video');
const buttons = document.querySelectorAll('.video-button');
const loadingOverlay = document.getElementById('loadingOverlay');
let hls = null;

function saveProgress(url, time){ localStorage.setItem("progress_" + url, time.toFixed(1)); }
function loadProgress(url){ const t=parseFloat(localStorage.getItem("progress_" + url)); return isNaN(t)?0:t; }
function setActiveButton(enc){ buttons.forEach(btn=>btn.classList.toggle('active',btn.dataset.enc.trim()===enc)); }
function showLoading(){ loadingOverlay.style.display='flex'; }
function hideLoading(){ loadingOverlay.style.display='none'; }

function decodeBase64(str){
  try { return atob(str.replace(/[\r\n\s]/g, "")); }
  catch(e){ return ""; }
}

function loadVideo(url, resumeTime, isM3U8){
  video.pause();
  video.removeAttribute('src');
  video.load();

  if(hls){ 
    hls.destroy(); 
    hls = null; 
  }

  if(isM3U8 && typeof Hls !== 'undefined'){
    hls = new Hls({
      maxBufferLength: 30,
      maxMaxBufferLength: 60,
      fragLoadingTimeOut: 20000,
      manifestLoadingTimeOut: 20000,
      enableWorker: true,
      startFragPrefetch: true
    });
    hls.loadSource(url);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      video.currentTime = resumeTime;
      video.play().catch(()=>{});
      hideLoading();
    });

    hls.on(Hls.Events.ERROR, function(event, data){
      console.error("Hls.js error:", data);
      if(data.fatal){
        switch(data.type){
          case Hls.ErrorTypes.NETWORK_ERROR:
            console.warn("网络错误，尝试重新加载...");
            hls.startLoad();
            break;
          case Hls.ErrorTypes.MEDIA_ERROR:
            console.warn("媒体错误，尝试恢复...");
            hls.recoverMediaError();
            break;
          default:
            console.warn("无法恢复的错误，销毁 Hls 实例");
            hls.destroy();
            hideLoading();
            break;
        }
      }
    });

  } else {
    video.src = url;
    video.addEventListener('loadedmetadata', function onLoaded(){
      video.removeEventListener('loadedmetadata', onLoaded);
      video.currentTime = resumeTime;
      video.play().catch(()=>{});
      hideLoading();
    });
  }

  video.controls = true;

  video.removeEventListener('timeupdate', video._saveHandler);
  video._saveHandler = ()=>saveProgress(url, video.currentTime);
  video.addEventListener('timeupdate', video._saveHandler);
}

function loadVideoFromEncoded(encStr){
  const url = decodeBase64(encStr.trim());
  if(!url) return;
  const isM3U8 = url.includes(".m3u8");
  setActiveButton(encStr);
  showLoading();
  const resumeTime = loadProgress(url);
  loadVideo(url, resumeTime, isM3U8);
}

loadVideoFromEncoded(buttons[0].dataset.enc.trim());

buttons.forEach(btn => {
  btn.addEventListener('click', ()=>loadVideoFromEncoded(btn.dataset.enc.trim()));
});

video.addEventListener('playing', hideLoading);
video.addEventListener('canplay', hideLoading);
</script>
</body>
</html>
